# ðŸš€ DashDice Go Services - Production Deployment Guide

## Overview
This guide will help you deploy the DashDice Go services to a production server at `https://api.dashdice.gg`.

## Prerequisites

### 1. Server Requirements
- **VPS/Cloud Server** (recommended: 2+ CPU, 4GB+ RAM, 20GB+ SSD)
- **Ubuntu 20.04+ / Debian 11+** (or similar Linux distribution)
- **Domain**: `api.dashdice.gg` pointing to your server's IP
- **SSH access** to the server

### 2. Recommended Providers
- **DigitalOcean**: $20/month droplet (2 CPU, 4GB RAM)
- **Linode**: $20/month VPS (2 CPU, 4GB RAM)
- **AWS EC2**: t3.medium instance
- **Google Cloud**: e2-medium instance
- **Vultr**: $20/month VPS

## Step-by-Step Deployment

### Step 1: Set Up Your Server

1. **Create a VPS** with your preferred provider
2. **Point DNS**: Set `api.dashdice.gg` A record to your server's IP
3. **SSH into your server**:
   ```bash
   ssh root@your-server-ip
   ```

### Step 2: Initial Server Setup

```bash
# Update system
apt update && apt upgrade -y

# Create a non-root user
adduser dashdice
usermod -aG sudo dashdice

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
usermod -aG docker dashdice

# Install Docker Compose
curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose

# Switch to dashdice user
su - dashdice
```

### Step 3: Deploy the Go Services

```bash
# Clone your repository (or upload files)
git clone https://github.com/LukeAtkinz/dashdice.git
cd dashdice/go-services

# Make deployment script executable
chmod +x deploy-production.sh

# Run deployment
./deploy-production.sh --email your-email@example.com --domain api.dashdice.gg
```

### Step 4: Verify Deployment

```bash
# Check service status
docker-compose -f docker-compose.production.yml ps

# Test API health
curl https://api.dashdice.gg/health

# Check logs
docker-compose -f docker-compose.production.yml logs -f api-gateway
```

## Configuration

### Environment Variables
The deployment script creates `.env.production` with secure random passwords. Key variables:

```bash
ENVIRONMENT=production
POSTGRES_PASSWORD=<auto-generated>
REDIS_PASSWORD=<auto-generated>
JWT_SECRET=<auto-generated>
```

### SSL Certificate
- Automatically generated using Let's Encrypt
- Auto-renewal configured
- HTTPS enforced for all traffic

### Security Features
- Firewall configured (UFW)
- Rate limiting (10 req/sec for API)
- Security headers
- Internal network isolation
- Strong SSL configuration

## Monitoring & Maintenance

### Health Monitoring
- Automatic health checks every 5 minutes
- Service restart on failure
- Logs saved to `/var/log/dashdice/`

### Backups
- Daily database backups at 2 AM
- Redis snapshots included
- 7-day retention policy
- Stored in `/opt/dashdice/backups/`

### Log Locations
```bash
# Application logs
docker-compose -f docker-compose.production.yml logs [service-name]

# System logs
/var/log/dashdice/

# Nginx logs
docker-compose -f docker-compose.production.yml logs nginx
```

## Troubleshooting

### Check Service Health
```bash
# All services
docker-compose -f docker-compose.production.yml ps

# Specific service logs
docker-compose -f docker-compose.production.yml logs api-gateway
```

### Common Issues

1. **SSL Certificate Failed**
   ```bash
   # Check DNS propagation
   nslookup api.dashdice.gg
   
   # Retry certificate
   docker-compose -f docker-compose.production.yml run --rm certbot renew
   ```

2. **Services Not Starting**
   ```bash
   # Check logs
   docker-compose -f docker-compose.production.yml logs
   
   # Restart services
   docker-compose -f docker-compose.production.yml restart
   ```

3. **Database Connection Issues**
   ```bash
   # Check PostgreSQL
   docker exec -it dashdice-postgres psql -U dashdice_prod -d dashdice_prod
   ```

### Performance Tuning

1. **Database Optimization**
   ```bash
   # Monitor connections
   docker exec dashdice-postgres psql -U dashdice_prod -d dashdice_prod -c "SELECT * FROM pg_stat_activity;"
   ```

2. **Redis Monitoring**
   ```bash
   # Redis info
   docker exec dashdice-redis redis-cli info
   ```

## Scaling

### Horizontal Scaling
- Add load balancer (nginx proxy)
- Multiple API Gateway instances
- Redis cluster for high availability

### Vertical Scaling
- Increase server resources
- Optimize database queries
- Implement caching strategies

## Security Checklist

- âœ… Firewall configured
- âœ… Non-root user setup
- âœ… SSL/TLS encryption
- âœ… Strong passwords generated
- âœ… Rate limiting enabled
- âœ… Security headers configured
- âœ… Database access restricted
- âœ… Regular backups scheduled

## Support

### Useful Commands
```bash
# View all services
docker-compose -f docker-compose.production.yml ps

# Restart all services
docker-compose -f docker-compose.production.yml restart

# Update services
git pull
docker-compose -f docker-compose.production.yml build --no-cache
docker-compose -f docker-compose.production.yml up -d

# View logs
docker-compose -f docker-compose.production.yml logs -f [service-name]

# Backup now
/opt/dashdice/backup.sh

# Check monitoring
tail -f /var/log/dashdice/monitor.log
```

### Getting Help
- Check logs first: `docker-compose logs`
- Verify DNS: `nslookup api.dashdice.gg`
- Test connectivity: `curl https://api.dashdice.gg/health`
- Monitor resources: `htop`, `df -h`, `free -m`

---

**Next Step**: Once deployed, update your frontend's `GO_BACKEND_URL` environment variable on Vercel to use the production API, and your system will automatically switch from Firebase to the Go backend! ðŸŽ‰
